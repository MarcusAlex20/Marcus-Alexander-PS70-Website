<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PS70 - CakeBot Project | Marcus Alexander</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
</head>
<body>
    <div class="background-pattern"></div>
    <div class="content-wrapper">
        <header class="main-header">
            <nav class="nav-container">
                <div class="logo">MA</div>
                <ul class="nav-links">
                    <li><a href="index.html" class="nav-link">Home</a></li>
                    <li><a href="index.html#about" class="nav-link">About</a></li>
                    <li><a href="index.html#education" class="nav-link">Education</a></li>
                    <li><a href="index.html#ps70" class="nav-link">PS70 Projects</a></li>
                    <li><a href="index.html#contact" class="nav-link">Contact</a></li>
                </ul>
                <div class="menu-toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </nav>
        </header>

        <main class="project-page">
            <section class="project-hero">
                <h1 class="project-title" data-aos="fade-up">CakeBot: Automated Cake Decorating System</h1>
                <div class="project-meta" data-aos="fade-up" data-aos-delay="100">
                    <span class="project-date">Spring 2024</span>
                    <span class="project-category">Featured Project</span>
                </div>
            </section>

            <section class="project-content">
                <div class="project-section" data-aos="fade-up">
                    <h2>Project Overview</h2>
                    <div class="project-content">
                        <div class="image-gallery">
                            <div class="gallery-item">
                                <img src="images_index/Cake_project.jpeg" alt="CakeBot System">
                                <p class="caption">The CakeBot automated cake decorating system</p>
                            </div>
                            <div class="gallery-item">
                                <img src="cakebot_photos/cakebot_gif1.gif" alt="CakeBot in Action">
                                <p class="caption">CakeBot decorating process in action</p>
                            </div>
                            <div class="gallery-item">
                                <img src="cakebot_photos/cakebot_gif2.gif" alt="CakeBot Stencil Mechanism">
                                <p class="caption">CakeBot stencil mechanism demonstration</p>
                            </div>
                        </div>
                        <p>CakeBot is an innovative automated cake decorating system that combines robotics with culinary arts. The project aims to revolutionize the cake decorating industry by providing precise, consistent, and creative designs through automated processes.</p>
                    </div>
                </div>

                <div class="project-section" data-aos="fade-up">
                    <h2>Stencil Mechanism</h2>
                    <div class="project-content">
                        <p class="highlight-text">The CakeBot uses a sophisticated stencil mechanism that converts images into polar coordinates for precise cake decoration. This system allows for the creation of intricate designs by mapping image pixels to physical movements of the decorating tools.</p>
                        
                        <div class="image-gallery">
                            <div class="gallery-item">
                                <img src="images_index/Cake_project.jpeg" alt="CakeBot Stencil System">
                                <p class="caption">The stencil mechanism in action</p>
                            </div>
                        </div>
                        
                        <h3>How It Works</h3>
                        <p class="highlight-text">The stencil mechanism works by:</p>
                        <ol class="numbered-list">
                            <li>Converting uploaded images into a series of polar coordinates</li>
                            <li>Mapping these coordinates to precise motor movements</li>
                            <li>Controlling the decorating tools to recreate the design on the cake surface</li>
                        </ol>
                        
                        <div class="technical-explanation">
                            <h3>Technical Architecture</h3>
                            <p class="highlight-text">The CakeBot system integrates three key components working together:</p>
                            
                            <div class="architecture-diagram">
                                <div class="component">
                                    <h4>HTML Interface</h4>
                                    <p>Provides the user interface for uploading images, displaying processed results, and controlling the system.</p>
                                </div>
                                <div class="component">
                                    <h4>JavaScript Processing</h4>
                                    <p>Handles image processing, coordinate conversion, and G-code generation.</p>
                                </div>
                                <div class="component">
                                    <h4>Arduino Control</h4>
                                    <p>Interprets G-code commands and controls the physical motors for precise movement.</p>
                                </div>
                            </div>
                            
                            <h4>Data Flow</h4>
                            <ol class="data-flow">
                                <li>User uploads an image through the HTML interface</li>
                                <li>JavaScript processes the image to extract black pixels</li>
                                <li>Cartesian coordinates (x,y) are converted to polar coordinates (r,θ)</li>
                                <li>G-code commands are generated based on the polar coordinates</li>
                                <li>G-code is sent to the Arduino via Web Serial API</li>
                                <li>Arduino parses the G-code and controls the motors accordingly</li>
                                <li>Motors move the decorating tools to recreate the design on the cake</li>
                            </ol>
                            
                            <div class="detailed-explanation">
                                <h4>Image to Stencil Process</h4>
                                
                                <div class="explanation-card">
                                    <h5>1. Image Upload and Processing</h5>
                                    <p>When a user uploads an image through the web interface:</p>
                                    <ul class="bullet-list">
                                        <li>The image is loaded into a canvas element in the browser</li>
                                        <li>JavaScript analyzes each pixel to determine its brightness</li>
                                        <li>Pixels darker than a threshold (typically 128 on a 0-255 scale) are identified as "black" pixels</li>
                                        <li>These black pixels represent the areas where frosting will be applied to the cake</li>
                                    </ul>
                                </div>
                                
                                <div class="explanation-card">
                                    <h5>2. Coordinate Transformation</h5>
                                    <p>The system performs a mathematical transformation:</p>
                                    <ul class="bullet-list">
                                        <li>For each black pixel, the system calculates its position relative to the image center</li>
                                        <li>Cartesian coordinates (x,y) are converted to polar coordinates (r,θ)</li>
                                        <li>Where r is the distance from the center and θ is the angle in degrees</li>
                                        <li>This transformation is crucial for the circular motion of the decorating arm</li>
                                    </ul>
                                </div>
                                
                                <div class="explanation-card">
                                    <h5>3. G-code Generation</h5>
                                    <p>The polar coordinates are converted to G-code commands:</p>
                                    <ul class="bullet-list">
                                        <li>Each coordinate pair generates a G1 command (linear movement)</li>
                                        <li>The format is: G1 X{r} Y{θ}</li>
                                        <li>These commands tell the motors exactly where to move</li>
                                        <li>The system optimizes the path to minimize travel time</li>
                                    </ul>
                                </div>
                                
                                <div class="explanation-card">
                                    <h5>4. Communication with Arduino</h5>
                                    <p>The system communicates with the Arduino in two possible ways:</p>
                                    <ul class="bullet-list">
                                        <li><strong>Direct Serial Connection:</strong> Using the Web Serial API, the browser can establish a direct connection to the Arduino</li>
                                        <li><strong>Web Server Method:</strong> The G-code is sent to a local web server running on the Arduino (using ESP8266/ESP32)</li>
                                        <li>The web server receives the commands via HTTP POST requests</li>
                                        <li>The Arduino processes these commands and controls the motors accordingly</li>
                                    </ul>
                                </div>
                                
                                <div class="explanation-card">
                                    <h5>5. Motor Control</h5>
                                    <p>On the Arduino side:</p>
                                    <ul class="bullet-list">
                                        <li>The Arduino receives and parses the G-code commands</li>
                                        <li>It extracts X and Y values from each command</li>
                                        <li>These values are mapped to appropriate servo angles</li>
                                        <li>The servos move to position the decorating tools precisely</li>
                                        <li>The system can control multiple axes for complex designs</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="interactive-demo">
                            <h3>Try It Out</h3>
                            <p class="highlight-text">Upload an image to see how the CakeBot converts it into polar coordinates for decoration:</p>
                            
                            <div class="stencil-demo">
                                <div class="upload-section">
                                    <input type="file" id="imageUpload" accept="image/*" class="file-input" />
                                    <label for="imageUpload" class="file-label">Choose Image</label>
                                </div>
                                
                                <div class="canvas-container">
                                    <div class="canvas-wrapper">
                                        <h4>Original Image</h4>
                                        <canvas id="imageCanvas" width="300" height="300"></canvas>
                                    </div>
                                    <div class="canvas-wrapper">
                                        <h4>Polar Coordinate Visualization</h4>
                                        <canvas id="redrawCanvas" width="300" height="300"></canvas>
                                    </div>
                                </div>
                                
                                <div class="coordinates-display">
                                    <h4>Polar Coordinates (r, θ in degrees)</h4>
                                    <textarea id="log" readonly class="coordinates-textarea"></textarea>
                                    
                                    <h4>Motor Control Code</h4>
                                    <textarea id="arduinoCodeLog" readonly class="arduino-code"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="project-section" data-aos="fade-up">
                    <h2>Design Process</h2>
                    <div class="process-steps">
                        <div class="step">
                            <h3>Step 1: Conceptualization</h3>
                            <p>Initial design and planning phase focusing on the core functionality and user requirements.</p>
                        </div>
                        <div class="step">
                            <h3>Step 2: Mechanical Design</h3>
                            <p>Development of the robotic arm system and precise movement controls.</p>
                        </div>
                        <div class="step">
                            <h3>Step 3: Software Integration</h3>
                            <p>Implementation of control systems and user interface for design input.</p>
                        </div>
                    </div>
                </div>

                <div class="project-section" data-aos="fade-up">
                    <h2>Technical Details</h2>
                    <div class="code-block">
                        <pre><code>
// System Specifications
robotic_arm = {
    degrees_of_freedom: 6,
    precision: "0.1mm",
    max_payload: "2kg"
}

control_system = {
    interface: "Touch Screen",
    design_input: "Vector Graphics",
    pattern_library: "Custom Designs"
}

decorating_tools = [
    "Frosting Nozzles",
    "Sprinkle Dispensers",
    "Pattern Stencils"
]
                        </code></pre>
                    </div>
                </div>

                <div class="project-section" data-aos="fade-up">
                    <h2>Key Features</h2>
                    <ul class="features-list">
                        <li>Precise robotic arm movement for detailed decorations</li>
                        <li>Custom design input through user-friendly interface</li>
                        <li>Multiple decorating tool options</li>
                        <li>Pattern library with customizable designs</li>
                        <li>Real-time monitoring and adjustment capabilities</li>
                    </ul>
                </div>

                <div class="project-section" data-aos="fade-up">
                    <h2>Challenges & Solutions</h2>
                    <div class="challenges">
                        <div class="challenge">
                            <h3>Precision Control</h3>
                            <p>Maintaining precise control over frosting application and decoration placement.</p>
                            <h4>Solution</h4>
                            <p>Implemented advanced motion control algorithms and feedback systems.</p>
                        </div>
                        <div class="challenge">
                            <h3>Design Flexibility</h3>
                            <p>Creating a system that can handle various cake sizes and design complexities.</p>
                            <h4>Solution</h4>
                            <p>Developed modular tool attachments and adaptive control systems.</p>
                        </div>
                    </div>
                </div>

                <div class="project-section" data-aos="fade-up">
                    <h2>Future Improvements</h2>
                    <ul class="improvements-list">
                        <li>Integration of AI for design suggestions</li>
                        <li>Expanded pattern library</li>
                        <li>Enhanced user interface with 3D preview</li>
                        <li>Automated cleaning and maintenance systems</li>
                        <li>Cloud-based design sharing platform</li>
                    </ul>
                </div>
            </section>

            <section class="project-navigation">
                <a href="index.html#projects" class="nav-button">← Back to Projects</a>
            </section>
        </main>

        <footer class="main-footer">
            <p>&copy; 2024 Marcus Alexander. All rights reserved.</p>
        </footer>
    </div>

    <script>
        // Initialize AOS
        AOS.init({
            duration: 1000,
            once: true
        });

        // Mobile menu toggle
        const menuToggle = document.querySelector('.menu-toggle');
        const navLinks = document.querySelector('.nav-links');
        
        menuToggle.addEventListener('click', () => {
            navLinks.classList.toggle('active');
            menuToggle.classList.toggle('active');
        });
    </script>

    <style>
        .interactive-demo {
            background-color: #0a192f;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        
        .stencil-demo {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .upload-section {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .file-input {
            display: none;
        }
        
        .file-label {
            background-color: #64ffda;
            color: #0a192f;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .file-label:hover {
            background-color: #4cd2b0;
            transform: translateY(-2px);
        }
        
        .canvas-container {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .canvas-wrapper {
            flex: 1;
            min-width: 300px;
            text-align: center;
        }
        
        canvas {
            border: 1px solid rgba(100, 255, 218, 0.3);
            border-radius: 5px;
            background-color: #ffffff;
        }
        
        .coordinates-display {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .coordinates-textarea, .arduino-code {
            width: 100%;
            height: 150px;
            background-color: #ffffff;
            color: #0a192f;
            border: 1px solid rgba(100, 255, 218, 0.3);
            border-radius: 5px;
            padding: 10px;
            font-family: 'Courier New', monospace;
            resize: vertical;
        }
        
        .technical-explanation {
            background-color: #0a192f;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        
        .architecture-diagram {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .component {
            flex: 1;
            min-width: 250px;
            background-color: #ffffff;
            border: 1px solid rgba(100, 255, 218, 0.3);
            border-radius: 5px;
            padding: 15px;
            text-align: center;
        }
        
        .component h4 {
            color: #0a192f;
            margin-bottom: 10px;
        }
        
        .component p {
            color: #0a192f;
        }
        
        .data-flow {
            background-color: #ffffff;
            border: 1px solid rgba(100, 255, 218, 0.3);
            border-radius: 5px;
            padding: 15px 15px 15px 40px;
            margin: 20px 0;
            color: #0a192f;
        }
        
        .data-flow li {
            margin-bottom: 10px;
        }
        
        .detailed-explanation {
            margin-top: 30px;
        }
        
        .explanation-card {
            background-color: #ffffff;
            border: 1px solid rgba(100, 255, 218, 0.3);
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .explanation-card h5 {
            color: #0a192f;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .explanation-card p {
            color: #0a192f;
        }
        
        .explanation-card ul {
            padding-left: 20px;
        }
        
        .explanation-card li {
            margin-bottom: 5px;
            color: #0a192f;
        }
        
        .project-content p, .project-content li {
            color: #0a192f;
            line-height: 1.6;
            font-size: 1.1em;
        }
        
        .project-section h2, .project-section h3, .project-section h4 {
            color: #0a192f;
            margin-top: 30px;
        }
        
        .highlight-text {
            font-weight: bold;
            font-size: 1.2em;
        }
        
        .numbered-list, .bullet-list {
            padding-left: 20px;
        }
        
        .numbered-list li, .bullet-list li {
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .image-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .gallery-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .gallery-item img {
            max-width: 100%;
            border-radius: 5px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .gallery-item .caption {
            margin-top: 10px;
            text-align: center;
            font-style: italic;
        }
        
        @media (max-width: 768px) {
            .canvas-container, .architecture-diagram {
                flex-direction: column;
            }
            
            .canvas-wrapper, .component {
                width: 100%;
            }
            
            .image-gallery {
                grid-template-columns: 1fr;
            }
        }
    </style>

    <script>
        // Stencil Mechanism Demo
        document.addEventListener('DOMContentLoaded', function() {
            const canvas = document.getElementById('imageCanvas');
            const ctx = canvas.getContext('2d');
            const logArea = document.getElementById('log');
            const redrawCanvas = document.getElementById('redrawCanvas');
            const redrawCtx = redrawCanvas.getContext('2d');
            const arduinoCodeLog = document.getElementById('arduinoCodeLog');
            let coordinates = [];

            document.getElementById('imageUpload').addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (!file) return;

                const img = new Image();
                img.onload = () => {
                    const scale = Math.min(canvas.width / img.width, canvas.height / img.height);
                    const imgWidth = img.width * scale;
                    const imgHeight = img.height * scale;
                    const xOffset = (canvas.width - imgWidth) / 2;
                    const yOffset = (canvas.height - imgHeight) / 2;

                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, xOffset, yOffset, imgWidth, imgHeight);

                    processImage(xOffset, yOffset, imgWidth, imgHeight);
                };
                img.onerror = () => {
                    alert("Failed to load the image. Please try again with a valid image file.");
                };
                img.src = URL.createObjectURL(file);
            });

            function processImage(xOffset, yOffset, width, height) {
                const imageData = ctx.getImageData(xOffset, yOffset, width, height);
                const data = imageData.data;
                coordinates = [];
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;

                for (let y = 0; y < height; y++) {
                    for (let x = 0; x < width; x++) {
                        const index = (y * width + x) * 4;
                        const avg = (data[index] + data[index + 1] + data[index + 2]) / 3;

                        if (avg < 128) { // Threshold for black pixels
                            const cartX = x + xOffset;
                            const cartY = y + yOffset;
                            const dx = cartX - centerX;
                            const dy = cartY - centerY;
                            const r = Math.sqrt(dx * dx + dy * dy);
                            const theta = (Math.atan2(dy, dx) * 180 / Math.PI + 360) % 360;
                            coordinates.push({ r, theta });
                        }
                    }
                }

                if (coordinates.length === 0) {
                    alert("No black pixels detected in the image. Please upload a valid image with black pixels.");
                } else {
                    logCoordinates(coordinates);
                    generateArduinoCode(coordinates);
                    redrawFromPolar(coordinates, centerX, centerY);
                }
            }

            function generateArduinoCode(coords) {
                const arduinoCommands = `#include <Servo.h>

Servo motorX;
Servo motorY;

const int motorXPin = 9; // PWM pin for X-axis motor
const int motorYPin = 10; // PWM pin for Y-axis motor

void setup() {
  Serial.begin(9600); // Initialize serial communication
  motorX.attach(motorXPin);
  motorY.attach(motorYPin);

  Serial.println("Waiting for G-code commands...");
}

void loop() {
  if (Serial.available()) {
    String command = Serial.readStringUntil('\\n'); // Read G-code command
    if (command.startsWith("G1")) {
      processGCode(command);
    }
  }
}

void processGCode(String gcode) {
  int xIndex = gcode.indexOf('X');
  int yIndex = gcode.indexOf('Y');
  if (xIndex != -1 && yIndex != -1) {
    float x = gcode.substring(xIndex + 1, yIndex).toFloat();
    float y = gcode.substring(yIndex + 1).toFloat();

    // Map Cartesian coordinates to servo angles (adjust ranges as needed)
    int angleX = map(x, -200, 200, 0, 180); // Adjust -200 to 200 range based on your setup
    int angleY = map(y, -200, 200, 0, 180);

    motorX.write(angleX);
    motorY.write(angleY);

    Serial.print("Moving to X: ");
    Serial.print(x);
    Serial.print(", Y: ");
    Serial.println(y);
  }
}`;

                arduinoCodeLog.value = arduinoCommands;
            }

            function logCoordinates(coords) {
                const text = coords.map(({ r, theta }) =>
                    `r: ${r.toFixed(2)}, θ: ${theta.toFixed(2)}°`
                ).join('\n');
                logArea.value = text;
            }

            function redrawFromPolar(coords, centerX, centerY) {
                redrawCtx.clearRect(0, 0, redrawCanvas.width, redrawCanvas.height);
                redrawCtx.fillStyle = '#64ffda';

                coords.forEach(({ r, theta }) => {
                    const thetaRad = (theta * Math.PI) / 180;
                    const x = centerX + r * Math.cos(thetaRad);
                    const y = centerY + r * Math.sin(thetaRad);
                    redrawCtx.fillRect(x, y, 1, 1); // Draw each point as a 1x1 pixel
                });
            }
        });
    </script>
</body>
</html> 